// This file is auto-generated. Do not edit manually.
// Edit files in prisma/schemas/ directory instead.
// Last generated: 2025-08-09T12:00:43.003Z

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // directUrl = env("DIRECT_URL")
}


// ==========================================
// ADMIN MASTER DATA
// üéØ Master Data Management Models
// For Admin Panel Data Management
// ==========================================

// prisma/schemas/admin-master-data.prisma
// Admin Master Data Management Schema (Fixed Relations)
// ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin Panel

// ================================
// PERSONNEL TYPES & ROLES
// ================================

enum PersonnelHierarchy {
  DEVELOPER           // ‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤ - ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
  DIRECTOR            // ‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£
  GROUP_HEAD          // ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô
  STAFF               // ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
  STUDENT             // ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
}

// ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏µ‡πà Admin ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ
model PersonnelType {
  id              String              @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital            @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£
  typeCode        String              // ‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡πÄ‡∏ä‡πà‡∏ô DIR, GRP_HEAD, STAFF, STU
  typeName        String              // ‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£
  typeNameEn      String?             // ‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
  
  // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÉ‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô
  hierarchy       PersonnelHierarchy
  levelOrder      Int                 // ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö (1=‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)
  
  // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ
  canManageHospitals      Boolean     @default(false) // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÑ‡∏î‡πâ
  canManageWarehouses     Boolean     @default(false) // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ
  canManageDepartments    Boolean     @default(false) // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡πÑ‡∏î‡πâ
  canManagePersonnel      Boolean     @default(false) // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡πÑ‡∏î‡πâ
  canManageDrugs          Boolean     @default(false) // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡πÑ‡∏î‡πâ
  canManageMasterData     Boolean     @default(false) // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏î‡πâ
  canViewReports          Boolean     @default(true)  // ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
  canApproveUsers         Boolean     @default(false) // ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
  description     String?
  responsibilities Json?              // ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö (array)
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
  maxSubordinates Int?                // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
  defaultDepartmentType String?       // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean             @default(true)
  isSystemDefault Boolean             @default(false) // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö
  
  // ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  createdBy       String
  creator         User                @relation("PersonnelTypeCreator", fields: [createdBy], references: [id], onDelete: Restrict)
  
  // Audit fields
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  // ================================
  // RELATIONS
  // ================================
  
  // Users ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ PersonnelType ‡∏ô‡∏µ‡πâ
  users           User[]              @relation("UserPersonnelType")
  
  @@unique([hospitalId, typeCode])
  @@index([hospitalId, hierarchy])
  @@index([isActive])
  @@map("personnel_types")
}

// ================================
// DRUG MASTER DATA
// ================================

// ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏¢‡∏≤
model DrugForm {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (Global ‡∏´‡∏£‡∏∑‡∏≠ Hospital-specific)
  hospitalId      String?     // null = Global, ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ = Hospital-specific
  hospital        Hospital?   @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏¢‡∏≤
  formCode        String      // ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡πÄ‡∏ä‡πà‡∏ô TAB, CAP, INJ
  formName        String      // ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏≤‡πÄ‡∏°‡πá‡∏î
  formNameEn      String?     // ‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
  
  // ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
  description     String?
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°
  category        String?     // ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ‡πÄ‡∏ä‡πà‡∏ô ORAL, INJECTION, TOPICAL
  
  // ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏â‡∏û‡∏≤‡∏∞
  requiresSpecialStorage Boolean @default(false) // ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏û‡∏¥‡πÄ‡∏®‡∏©
  isControlledForm Boolean   @default(false)     // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
  
  // ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  usageInstructions String?  // ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
  commonStrengths Json?       // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢ (array)
  standardUnits   Json?       // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (array)
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean     @default(true)
  isSystemDefault Boolean     @default(false)
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á
  sortOrder       Int         @default(0)
  
  // ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  createdBy       String?
  creator         User?       @relation("DrugFormCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  // Relations
  drugs           Drug[]      @relation("DrugFormRelation")
  
  @@unique([hospitalId, formCode])
  @@index([hospitalId])
  @@index([category])
  @@index([isActive])
  @@map("drug_forms")
}

// ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏¢‡∏≤
model DrugGroup {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String?     // null = Global, ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ = Hospital-specific
  hospital        Hospital?   @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏¢‡∏≤
  groupCode       String      // ‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏•‡∏∏‡πà‡∏° ‡πÄ‡∏ä‡πà‡∏ô ANTI, ANALG
  groupName       String      // ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏° ‡πÄ‡∏ä‡πà‡∏ô Antibiotic
  groupNameTh     String?     // ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞
  
  // ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
  description     String?
  indication      String?     // ‡∏Ç‡πâ‡∏≠‡∏ö‡πà‡∏á‡πÉ‡∏ä‡πâ
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
  therapeuticClass String?    // ‡∏´‡∏°‡∏ß‡∏î‡∏¢‡∏≤‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤
  pharmacologicalClass String? // ‡∏´‡∏°‡∏ß‡∏î‡∏¢‡∏≤‡∏ï‡∏≤‡∏°‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤
  
  // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö hierarchy
  parentGroupId   String?
  parentGroup     DrugGroup?  @relation("DrugGroupHierarchy", fields: [parentGroupId], references: [id], onDelete: SetNull)
  childGroups     DrugGroup[] @relation("DrugGroupHierarchy")
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
  requiresMonitoring Boolean  @default(false) // ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ
  hasInteractions Boolean     @default(false) // ‡∏°‡∏µ‡∏õ‡∏è‡∏¥‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤
  riskLevel       String      @default("LOW") // LOW, MEDIUM, HIGH, CRITICAL
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean     @default(true)
  isSystemDefault Boolean     @default(false)
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á
  sortOrder       Int         @default(0)
  level           Int         @default(0) // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á hierarchy
  
  // ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  createdBy       String?
  creator         User?       @relation("DrugGroupCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  // Relations
  drugs           Drug[]      @relation("DrugGroupRelation")
  
  @@unique([hospitalId, groupCode])
  @@index([hospitalId])
  @@index([therapeuticClass])
  @@index([parentGroupId])
  @@index([isActive])
  @@map("drug_groups")
}

// ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏¢‡∏≤ (Drug Types)
model DrugType {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String?
  hospital        Hospital?   @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏¢‡∏≤
  typeCode        String      // ‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡πÄ‡∏ä‡πà‡∏ô HIGH_ALERT, NARCOTIC, REFER
  typeName        String      // ‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
  typeNameTh      String?     // ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢
  
  // ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
  isHighAlert     Boolean     @default(false)  // ‡∏¢‡∏≤ High Alert
  isNarcotic      Boolean     @default(false)  // ‡∏¢‡∏≤‡πÄ‡∏™‡∏û‡∏ï‡∏¥‡∏î
  isControlled    Boolean     @default(false)  // ‡∏¢‡∏≤‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
  isPsychotropic  Boolean     @default(false)  // ‡∏¢‡∏≤‡∏à‡∏¥‡∏ï‡πÄ‡∏ß‡∏ä
  isDangerous     Boolean     @default(false)  // ‡∏¢‡∏≤‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢
  isRefer         Boolean     @default(false)  // ‡∏¢‡∏≤ Refer
  
  // ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©
  requiresWitness Boolean     @default(false)  // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏û‡∏¢‡∏≤‡∏ô
  requiresApproval Boolean    @default(false)  // ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  requiresDoubleLock Boolean  @default(false)  // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏ö‡∏ö double lock
  maxDispenseQty  Int?                         // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö
  specialStorage  Json?       // ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏û‡∏¥‡πÄ‡∏®‡∏©
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  auditRequired   Boolean     @default(false)  // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ audit trail
  reportingRequired Boolean   @default(false)  // ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
  
  // ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
  description     String?
  precautions     String?     // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á
  warnings        String?     // ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
  
  // ‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UI
  color           String?     // ‡∏™‡∏µ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô UI
  iconName        String?     // ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean     @default(true)
  isSystemDefault Boolean     @default(false)
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á
  sortOrder       Int         @default(0)
  
  // ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  createdBy       String?
  creator         User?       @relation("DrugTypeCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  // Relations
  drugs           Drug[]      @relation("DrugTypeRelation")
  
  @@unique([hospitalId, typeCode])
  @@index([hospitalId])
  @@index([isHighAlert])
  @@index([isNarcotic])
  @@index([isActive])
  @@map("drug_types")
}

// ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏¢‡∏≤
model DrugStorage {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String?
  hospital        Hospital?   @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö
  storageCode     String      // ‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö ‡πÄ‡∏ä‡πà‡∏ô RT, FRIDGE, FREEZE
  storageName     String      // ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö
  storageNameTh   String?     // ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢
  
  // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö
  temperatureMin  Decimal?    // ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î (¬∞C)
  temperatureMax  Decimal?    // ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (¬∞C)
  humidityMin     Decimal?    // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î (%)
  humidityMax     Decimal?    // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (%)
  
  // ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©
  requiresRefrigeration Boolean @default(false)  // ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡πà‡πÄ‡∏¢‡πá‡∏ô
  requiresFreezing    Boolean   @default(false)  // ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡πà‡πÅ‡∏Ç‡πá‡∏á
  protectFromLight    Boolean   @default(false)  // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏™‡∏á
  protectFromMoisture Boolean   @default(false)  // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô
  requiresInertGas    Boolean   @default(false)  // ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÅ‡∏Å‡πä‡∏™‡πÄ‡∏â‡∏∑‡πà‡∏≠‡∏¢
  
  // ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
  storageInstructions String?
  handlingPrecautions String?
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  monitoringRequired Boolean   @default(false)   // ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏†‡∏≤‡∏û
  checkFrequency     String?   // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  
  // ‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
  color              String?   // ‡∏™‡∏µ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô UI
  iconName           String?   // ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive           Boolean   @default(true)
  isSystemDefault    Boolean   @default(false)
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á
  sortOrder          Int       @default(0)
  
  // ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  createdBy          String?
  creator            User?     @relation("DrugStorageCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  
  // Audit fields
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  
  // Relations
  drugs              Drug[]    @relation("DrugStorageRelation")
  
  @@unique([hospitalId, storageCode])
  @@index([hospitalId])
  @@index([requiresRefrigeration])
  @@index([isActive])
  @@map("drug_storage_conditions")
}

// ==========================================
// AUTH
// ==========================================

// prisma/schemas/auth.prisma
// Authentication and User Management Schema (Fixed Relations)
// ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Hospital Pharmacy System

enum Role {
  DEVELOPER           // ‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤ - ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡πÉ‡∏´‡∏°‡πà)
  HOSPITAL_ADMIN      // ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• - ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏ï‡πá‡∏°
  PHARMACY_MANAGER    // ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏£‡∏° - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  SENIOR_PHARMACIST   // ‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏≠‡∏≤‡∏ß‡∏∏‡πÇ‡∏™ - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤
  STAFF_PHARMACIST    // ‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥ - ‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å
  DEPARTMENT_HEAD     // ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å - ‡πÄ‡∏ö‡∏¥‡∏Å‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
  STAFF_NURSE         // ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥ - ‡πÄ‡∏ö‡∏¥‡∏Å‡∏¢‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
  PHARMACY_TECHNICIAN // ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏£‡∏° - ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö
  DIRECTOR            // ‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ (‡πÉ‡∏´‡∏°‡πà)
  GROUP_HEAD          // ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô (‡πÉ‡∏´‡∏°‡πà)  
  STAFF               // ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (‡πÉ‡∏´‡∏°‡πà)
  STUDENT             // ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡πÉ‡∏´‡∏°‡πà)
}

enum UserStatus {
  PENDING   // ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  ACTIVE    // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
  INACTIVE  // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
  SUSPENDED // ‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  DELETED   // ‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß (soft delete)
}

model User {
  id            String      @id @default(uuid())
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
  email         String      @unique
  name          String
  username      String      @unique  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö login
  firstName     String?     // ‡∏ä‡∏∑‡πà‡∏≠
  lastName      String?     // ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
  phoneNumber   String?
  employeeId    String?     // ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
  position      String?     // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
  
  // ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô
  emailVerified Boolean     @default(false)
  password      String?     // hashed password
  
  // Profile completion tracking
  isProfileComplete Boolean @default(false)
  
  // ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
  role          Role
  status        UserStatus  @default(PENDING)
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö Personnel Type (Master Data) - Fixed relation name
  personnelTypeId String?
  personnelType PersonnelType? @relation("UserPersonnelType", fields: [personnelTypeId], references: [id], onDelete: SetNull)
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•
  hospitalId    String
  hospital      Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å (optional ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö pharmacy staff)
  departmentId  String?
  department    Department? @relation(fields: [departmentId], references: [id], onDelete: SetNull)
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
  lastLoginAt   DateTime?
  lastLoginIP   String?
  loginCount    Int         @default(0)
  
  // ================================
  // USER APPROVAL SYSTEM FIELDS
  // ================================
  
  // ‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  approvedAt      DateTime?    // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  approvedBy      String?      // ‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (User ID)
  rejectedAt      DateTime?    // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
  rejectedBy      String?      // ‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò (User ID)
  rejectionReason String?      // ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° changes
  lastModifiedBy  String?      // ‡∏ú‡∏π‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (User ID)
  statusChangedAt DateTime?    // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  statusHistory   Json?        // ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  applicationNotes String?     // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£
  approvalNotes   String?      // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  requestedRole   Role?        // ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ó‡∏µ‡πà‡∏Ç‡∏≠ (‡∏≠‡∏≤‡∏à‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö)
  
  // ================================
  // AUDIT FIELDS
  // ================================
  
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  createdBy     String?     // ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
  
  // ================================
  // BETTER AUTH COMPATIBILITY
  // ================================
  
  // Better Auth required relations
  accounts      Account[]
  sessions      Session[]
  
  // ================================
  // RELATIONS (All opposite fields)
  // ================================
  
  // Authentication Relations (existing)
  refreshTokens            RefreshToken[]
  passwordResetTokens      PasswordResetToken[]
  emailVerificationTokens  EmailVerificationToken[]
  loginAttempts            LoginAttempt[]
  
  // Department & Warehouse Management
  departmentsManaged       Department[]     @relation("DepartmentHead")
  warehousesManaged        Warehouse[]      @relation("WarehouseManager")
  
  // Stock Management
  stockTransactions        StockTransaction[]
  stockCountsAsCounter     StockCount[]     @relation("StockCounter")
  stockCountsAsVerifier    StockCount[]     @relation("StockCountVerifier")
  
  // Requisition System
  requisitionsCreated      Requisition[]    @relation("RequesterRelation")
  requisitionsApproved     Requisition[]    @relation("ApproverRelation")
  requisitionsFulfilled    Requisition[]    @relation("FulfillerRelation")
  workflowActions          RequisitionWorkflow[]
  requisitionAttachments   RequisitionAttachment[]
  requisitionTemplatesCreated RequisitionTemplate[]
  
  // Supplier Management
  purchaseOrdersCreated    PurchaseOrder[]  @relation("POOrderer")
  purchaseOrdersApproved   PurchaseOrder[]  @relation("POApprover")
  goodsReceiptsReceived    GoodsReceipt[]   @relation("GRReceiver")
  goodsReceiptsVerified    GoodsReceipt[]   @relation("GRVerifier")
  supplierEvaluations      SupplierEvaluation[]
  
  // Analytics & Reporting
  reportsRequested         Report[]
  dashboards               Dashboard[]
  systemUsageLogs          SystemUsage[]
  
  // Audit & Compliance
  auditLogs                AuditLog[]
  dataAccessLogs           DataAccessLog[]
  complianceChecksPerformed ComplianceCheck[] @relation("ComplianceChecker")
  complianceChecksReviewed ComplianceCheck[] @relation("ComplianceReviewer")
  controlledSubstanceLogsHandled ControlledSubstanceLog[] @relation("CSLHandler")
  controlledSubstanceLogsWitnessed ControlledSubstanceLog[] @relation("CSLWitness")
  controlledSubstanceLogsAuthorized ControlledSubstanceLog[] @relation("CSLAuthorizer")
  internalAudits           InternalAudit[]
  securityIncidentsReported SecurityIncident[] @relation("SecurityReporter")
  securityIncidentsSuspected SecurityIncident[] @relation("SuspectedUser")
  securityIncidentsInvestigated SecurityIncident[] @relation("Investigator")
  
  // Notifications
  notificationPreferences  NotificationPreference[]
  notifications            NotificationUser[]
  
  // ================================
  // USER APPROVAL RELATIONS
  // ================================
  
  // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ
  usersApproved           User[] @relation("UserApprover")
  usersRejected           User[] @relation("UserRejecter")
  
  // ‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ
  approver                User?  @relation("UserApprover", fields: [approvedBy], references: [id], onDelete: SetNull)
  rejecter                User?  @relation("UserRejecter", fields: [rejectedBy], references: [id], onDelete: SetNull)
  
  // ================================
  // MASTER DATA MANAGEMENT RELATIONS - Fixed relation names
  // ================================
  
  // Master Data Creation/Management
  personnelTypesCreated   PersonnelType[] @relation("PersonnelTypeCreator")
  drugFormsCreated        DrugForm[]      @relation("DrugFormCreator")
  drugGroupsCreated       DrugGroup[]     @relation("DrugGroupCreator")
  drugTypesCreated        DrugType[]      @relation("DrugTypeCreator")
  drugStorageCreated      DrugStorage[]   @relation("DrugStorageCreator")
  
  @@index([hospitalId])
  @@index([role])
  @@index([status])
  @@index([personnelTypeId])
  @@map("users")
}

// ================================
// BETTER AUTH REQUIRED MODELS
// ================================

model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  
  // Relation to User
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Better Auth requirement
  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  
  // Additional session fields
  ipAddress    String?
  userAgent    String?
  isActive     Boolean  @default(true)
  
  // Relation to User
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Audit fields
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([userId])
  @@index([sessionToken])
  @@index([expires])
  @@map("sessions")
}

// ================================
// EXISTING AUTH MODELS (Updated)
// ================================

model RefreshToken {
  id        String   @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• token
  token     String   @unique
  expiresAt DateTime
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isRevoked Boolean  @default(false)
  
  // Audit fields
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([token])
  @@map("refresh_tokens")
}

model PasswordResetToken {
  id        String   @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• token
  token     String   @unique
  expiresAt DateTime
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isUsed    Boolean  @default(false)
  
  // Audit fields
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([token])
  @@map("password_reset_tokens")
}

model EmailVerificationToken {
  id        String   @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• token
  token     String   @unique
  expiresAt DateTime
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isUsed    Boolean  @default(false)
  
  // Audit fields
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([token])
  @@map("email_verification_tokens")
}

model LoginAttempt {
  id        String   @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (nullable ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö failed attempts)
  userId    String?
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
  email     String
  ipAddress String
  userAgent String?
  
  // ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
  success   Boolean
  failureReason String?
  
  // Audit fields
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([email])
  @@index([ipAddress])
  @@index([createdAt])
  @@map("login_attempts")
}

// ==========================================
// HOSPITAL CORE
// ==========================================

// prisma/schemas/hospital-core.prisma
// Hospital Core Management Schema (Fixed Relations)
// ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Hospital Pharmacy System

enum HospitalStatus {
  ACTIVE          // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
  INACTIVE        // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
  SUSPENDED       // ‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  PENDING         // ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  MAINTENANCE     // ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤
}

enum HospitalType {
  GOVERNMENT      // ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏±‡∏ê
  PRIVATE         // ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô
  UNIVERSITY      // ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢
  MILITARY        // ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ó‡∏´‡∏≤‡∏£
  POLICE          // ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ï‡∏≥‡∏£‡∏ß‡∏à
  COMMUNITY       // ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ä‡∏∏‡∏°‡∏ä‡∏ô
  SPECIALIZED     // ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á
}

model Hospital {
  id              String          @id @default(uuid())
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
  name            String
  nameEn          String?         // ‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
  hospitalCode    String          @unique // ‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•
  
  // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  type            HospitalType
  status          HospitalStatus  @default(PENDING)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
  licenseNo       String?         // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
  licenseExpiry   DateTime?       // ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
  taxId           String?         // ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ
  registrationNo  String?         // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
  
  // ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
  address         String
  district        String?         // ‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á
  subDistrict     String?         // ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï
  province        String
  postalCode      String?
  country         String          @default("Thailand")
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
  phone           String?
  fax             String?
  email           String?
  website         String?
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  bedCount        Int?            // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á
  employeeCount   Int?            // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
  establishedYear Int?            // ‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
  timezone        String          @default("Asia/Bangkok")
  locale          String          @default("th-TH")
  currency        String          @default("THB")
  
  // ‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
  subscriptionPlan String?        // ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  subscriptionStart DateTime?     // ‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  subscriptionEnd DateTime?       // ‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
  maxUsers        Int?            // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
  maxWarehouses   Int?            // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  lastActivityAt  DateTime?       // ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  isTrialAccount  Boolean         @default(false)
  
  // Audit fields
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  // ================================
  // RELATIONS (Fixed opposite fields)
  // ================================
  
  // Core Relations
  users           User[]
  departments     Department[]
  warehouses      Warehouse[]
  
  // Drug & Inventory Relations
  drugs           Drug[]
  stockCards      StockCard[]
  stockCounts     StockCount[]
  
  // Requisition Relations
  requisitions    Requisition[]
  requisitionTemplates RequisitionTemplate[]
  
  // Supplier Relations
  purchaseOrders  PurchaseOrder[]
  goodsReceipts   GoodsReceipt[]
  supplierEvaluations SupplierEvaluation[]
  
  // Analytics Relations
  reports         Report[]
  dashboards      Dashboard[]
  systemUsage     SystemUsage[]
  
  // Audit Relations
  auditLogs       AuditLog[]
  dataAccessLogs  DataAccessLog[]
  complianceChecks ComplianceCheck[]
  controlledSubstanceLogs ControlledSubstanceLog[]
  internalAudits  InternalAudit[]
  securityIncidents SecurityIncident[]
  
  // Notification Relations
  notifications   Notification[]
  
  // Drug Information Relations
  drugCategories  DrugCategory[]
  drugInteractions DrugInteraction[]
  drugAllergens   DrugAllergen[]
  
  // ================================
  // MASTER DATA RELATIONS (Fixed) 
  // ================================
  
  // Personnel & Admin Relations
  personnelTypes  PersonnelType[]
  
  // Drug Master Data Relations
  drugForms       DrugForm[]
  drugGroups      DrugGroup[]
  drugTypes       DrugType[]
  drugStorage     DrugStorage[]
  
  @@index([hospitalCode])
  @@index([status])
  @@index([type])
  @@map("hospitals")
}

enum DepartmentType {
  PHARMACY        // ‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏£‡∏°
  EMERGENCY       // ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô
  ICU             // ‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡∏Å‡∏§‡∏ï
  SURGERY         // ‡∏®‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏°
  MEDICINE        // ‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°
  PEDIATRICS      // ‡∏Å‡∏∏‡∏°‡∏≤‡∏£‡πÄ‡∏ß‡∏ä‡∏Å‡∏£‡∏£‡∏°
  OBSTETRICS      // ‡∏™‡∏π‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°
  ORTHOPEDICS     // ‡∏≠‡∏≠‡∏£‡πå‡πÇ‡∏ò‡∏õ‡∏¥‡∏î‡∏¥‡∏Å‡∏™‡πå
  CARDIOLOGY      // ‡∏´‡∏±‡∏ß‡πÉ‡∏à
  NEUROLOGY       // ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó
  ONCOLOGY        // ‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤
  PSYCHIATRY      // ‡∏à‡∏¥‡∏ï‡πÄ‡∏ß‡∏ä
  RADIOLOGY       // ‡∏£‡∏±‡∏á‡∏™‡∏µ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤
  LABORATORY      // ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£
  OUTPATIENT      // ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å
  INPATIENT       // ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏ô
  ADMINISTRATION  // ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£
  OTHER           // ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
}

model Department {
  id              String          @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital        @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å
  name            String
  nameEn          String?         // ‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
  departmentCode  String          // ‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏ú‡∏ô‡∏Å
  type            DepartmentType
  
  // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£
  parentDepartmentId String?      // ‡πÅ‡∏ú‡∏ô‡∏Å‡πÅ‡∏°‡πà
  parentDepartment Department?    @relation("DepartmentHierarchy", fields: [parentDepartmentId], references: [id], onDelete: SetNull)
  childDepartments Department[]   @relation("DepartmentHierarchy")
  
  // ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
  headOfDepartmentId String?      // ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å
  headOfDepartment User?          @relation("DepartmentHead", fields: [headOfDepartmentId], references: [id], onDelete: SetNull)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  location        String?         // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á (‡∏ä‡∏±‡πâ‡∏ô, ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£)
  phone           String?         // ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
  email           String?         // ‡∏≠‡∏µ‡πÄ‡∏°‡∏•
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏¢‡∏≤
  allowRequisition Boolean        @default(true) // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏¥‡∏Å‡∏¢‡∏≤‡πÑ‡∏î‡πâ
  requireApproval Boolean         @default(false) // ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  maxRequisitionValue Decimal?    // ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
  
  // ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
  budgetLimit     Decimal?        // ‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
  currentSpending Decimal         @default(0) // ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean         @default(true)
  
  // Audit fields
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  // ================================
  // RELATIONS (Fixed opposite fields)
  // ================================
  
  // User Relations
  users           User[]          // ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å
  
  // Requisition Relations
  requisitions    Requisition[]   @relation("RequestingDepartment")
  requisitionTemplates RequisitionTemplate[]
  
  @@unique([hospitalId, departmentCode])
  @@index([hospitalId])
  @@index([type])
  @@index([isActive])
  @@map("departments")
}

enum WarehouseType {
  CENTRAL         // ‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏≤‡∏á
  DEPARTMENT      // ‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô‡∏Å
  EMERGENCY       // ‡∏Ñ‡∏•‡∏±‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô
  CONTROLLED      // ‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
  COLD_STORAGE    // ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏¢‡πá‡∏ô
  QUARANTINE      // ‡∏´‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏Å‡∏Å‡∏±‡∏ô
  DISPOSAL        // ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏•‡∏≤‡∏¢
  RECEIVING       // ‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á
  DISPENSING      // ‡∏´‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤
}

model Warehouse {
  id              String          @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital        @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏•‡∏±‡∏á
  name            String
  warehouseCode   String          // ‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏•‡∏±‡∏á
  type            WarehouseType
  
  // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á
  location        String          // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£, ‡∏ä‡∏±‡πâ‡∏ô, ‡∏´‡πâ‡∏≠‡∏á)
  address         String?         // ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
  
  // ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
  managerId       String?         // ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á
  manager         User?           @relation("WarehouseManager", fields: [managerId], references: [id], onDelete: SetNull)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ
  area            Decimal?        // ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏°‡∏ï‡∏£)
  capacity        Decimal?        // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏ (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)
  
  // ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°
  hasTemperatureControl Boolean   @default(false) // ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥
  minTemperature  Decimal?        // ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î (¬∞C)
  maxTemperature  Decimal?        // ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (¬∞C)
  hasHumidityControl Boolean      @default(false) // ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô
  minHumidity     Decimal?        // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î (%)
  maxHumidity     Decimal?        // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (%)
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
  securityLevel   String          @default("STANDARD") // "BASIC", "STANDARD", "HIGH", "MAXIMUM"
  accessControl   Boolean         @default(false) // ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á
  cctv            Boolean         @default(false) // ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ß‡∏á‡∏à‡∏£‡∏õ‡∏¥‡∏î
  alarm           Boolean         @default(false) // ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏†‡∏±‡∏¢
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô
  allowReceiving  Boolean         @default(true) // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á
  allowDispensing Boolean         @default(true) // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á
  allowTransfer   Boolean         @default(true) // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÇ‡∏≠‡∏ô
  requireApproval Boolean         @default(false) // ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean         @default(true)
  isMaintenance   Boolean         @default(false) // ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  lastStockCount  DateTime?       // ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  totalValue      Decimal         @default(0) // ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏ß‡∏°
  totalItems      Int             @default(0) // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  description     String?
  notes           String?
  
  // Audit fields
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  // ================================
  // RELATIONS (Fixed opposite fields)
  // ================================
  
  // Stock Relations
  stockCards      StockCard[]
  stockCounts     StockCount[]
  stockTransactions StockTransaction[]
  
  // Transfer Relations  
  transfersOut    StockTransaction[] @relation("TransferFrom")
  transfersIn     StockTransaction[] @relation("TransferTo")
  
  // Requisition Relations
  requisitions    Requisition[]   @relation("FulfillmentWarehouse")
  
  @@unique([hospitalId, warehouseCode])
  @@index([hospitalId])
  @@index([type])
  @@index([isActive])
  @@map("warehouses")
}

model Drug {
  id              String          @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital        @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
  hospitalDrugCode String         // ‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•
  name            String          // ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤
  genericName     String?         // ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏°‡∏±‡∏ç
  brandName       String?         // ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤
  
  // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏¢‡∏≤
  dosageForm      String          // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö (tablet, capsule, injection, etc.)
  strength        String?         // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á (500mg, 10mg/ml, etc.)
  unit            String          // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö (tablet, vial, bottle, etc.)
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
  therapeuticClass String?        // ‡∏´‡∏°‡∏ß‡∏î‡∏¢‡∏≤‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤
  pharmacologicalClass String?   // ‡∏´‡∏°‡∏ß‡∏î‡∏¢‡∏≤‡∏ï‡∏≤‡∏°‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤
  atcCode         String?         // ‡∏£‡∏´‡∏±‡∏™ ATC
  
  // ‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï
  manufacturer    String?         // ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï
  countryOfOrigin String?         // ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï
  registrationNo  String?         // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ï‡∏≥‡∏£‡∏±‡∏ö‡∏¢‡∏≤
  
  // ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
  isControlled    Boolean         @default(false) // ‡∏¢‡∏≤‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
  isNarcotic      Boolean         @default(false) // ‡∏¢‡∏≤‡πÄ‡∏™‡∏û‡∏ï‡∏¥‡∏î
  isPsychotropic  Boolean         @default(false) // ‡∏¢‡∏≤‡∏à‡∏¥‡∏ï‡πÄ‡∏ß‡∏ä
  isDangerous     Boolean         @default(false) // ‡∏¢‡∏≤‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢
  isHazardous     Boolean         @default(false) // ‡∏¢‡∏≤‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö
  storageCondition String?        // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö
  storageTemperature String?      // ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö
  requiresColdChain Boolean       @default(false) // ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏´‡πà‡∏ß‡∏á‡πÇ‡∏ã‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏¢‡πá‡∏ô
  lightSensitive  Boolean         @default(false) // ‡πÑ‡∏ß‡∏ï‡πà‡∏≠‡πÅ‡∏™‡∏á
  moistureSensitive Boolean       @default(false) // ‡πÑ‡∏ß‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à
  unitCost        Decimal?        // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢
  sellingPrice    Decimal?        // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢
  reimbursementPrice Decimal?     // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡πÑ‡∏î‡πâ
  averageCost     Decimal?        // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
  
  // ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  isActive        Boolean         @default(true)
  isFormulary     Boolean         @default(false) // ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏≤‡∏´‡∏•‡∏±‡∏Å
  isEmergencyDrug Boolean         @default(false) // ‡∏¢‡∏≤‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô
  isHighAlert     Boolean         @default(false) // ‡∏¢‡∏≤‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢
  requiresPrescription Boolean    @default(true) // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå
  maxDispenseQty  Int?            // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á
  maxDailyDose    String?         // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå
  packageSize     Int?            // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏
  packageUnit     String?         // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏à‡∏∏
  packageType     String?         // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå
  
  // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
  registrationDate DateTime?      // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
  approvalDate    DateTime?       // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ä‡πâ
  discontinuedDate DateTime?      // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏¢‡∏∏‡∏î‡πÉ‡∏ä‡πâ
  lastReviewDate  DateTime?       // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  nextReviewDate  DateTime?       // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
  indications     String?         // ‡∏Ç‡πâ‡∏≠‡∏ö‡πà‡∏á‡πÉ‡∏ä‡πâ
  contraindications String?       // ‡∏Ç‡πâ‡∏≠‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ
  sideEffects     String?         // ‡∏ú‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
  interactions    String?         // ‡∏õ‡∏è‡∏¥‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏¢‡∏≤
  dosageInstructions String?      // ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ
  precautions     String?         // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á
  warnings        String?         // ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
  notes           String?         // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  monthlyUsage    Int             @default(0) // ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
  yearlyUsage     Int             @default(0) // ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡∏õ‡∏µ
  lastUsageUpdate DateTime?       // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  
  // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
  popularityScore Decimal?        // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏¥‡∏¢‡∏°
  criticalityScore Decimal?       // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
  safetyScore     Decimal?        // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Barcode ‡πÅ‡∏•‡∏∞ QR Code
  barcode         String?         // ‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î
  qrCode          String?         // QR ‡πÇ‡∏Ñ‡πâ‡∏î
  
  // ================================
  // MASTER DATA RELATIONS (Fixed)
  // ================================
  
  // Drug Form Relation
  drugFormId      String?
  drugForm        DrugForm?       @relation("DrugFormRelation", fields: [drugFormId], references: [id], onDelete: SetNull)
  
  // Drug Group Relation
  drugGroupId     String?
  drugGroup       DrugGroup?      @relation("DrugGroupRelation", fields: [drugGroupId], references: [id], onDelete: SetNull)
  
  // Drug Type Relation
  drugTypeId      String?
  drugType        DrugType?       @relation("DrugTypeRelation", fields: [drugTypeId], references: [id], onDelete: SetNull)
  
  // Drug Storage Relation
  drugStorageId   String?
  drugStorage     DrugStorage?    @relation("DrugStorageRelation", fields: [drugStorageId], references: [id], onDelete: SetNull)
  
  // Audit fields
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  // ================================
  // RELATIONS (Fixed opposite fields)
  // ================================
  
  // Stock Relations
  stockCards      StockCard[]
  stockTransactions StockTransaction[]
  
  // Requisition Relations
  requisitionItems RequisitionItem[]
  
  // Supplier Relations
  supplierProducts SupplierProduct[]
  purchaseOrderItems PurchaseOrderItem[]
  goodsReceiptItems GoodsReceiptItem[]
  
  // Compliance Relations
  controlledSubstanceLogs ControlledSubstanceLog[]
  
  // Drug Information Relations
  drug1Interactions DrugInteraction[] @relation("Drug1Interactions")
  drug2Interactions DrugInteraction[] @relation("Drug2Interactions")
  allergens         DrugAllergen[]    @relation("DrugAllergens")
  
  @@unique([hospitalId, hospitalDrugCode])
  @@index([hospitalId])
  @@index([genericName])
  @@index([isActive])
  @@index([isControlled])
  @@index([isFormulary])
  @@index([barcode])
  @@index([drugFormId])
  @@index([drugGroupId])
  @@index([drugTypeId])
  @@index([drugStorageId])
  @@map("drugs")
}

// =============================================
// DRUG CATEGORIES AND CLASSIFICATIONS
// =============================================

model DrugCategory {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
  categoryCode    String      // ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
  categoryName    String      // ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
  description     String?     // ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
  
  // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
  parentCategoryId String?    // ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÅ‡∏°‡πà
  parentCategory  DrugCategory? @relation("CategoryHierarchy", fields: [parentCategoryId], references: [id], onDelete: SetNull)
  childCategories DrugCategory[] @relation("CategoryHierarchy")
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á
  sortOrder       Int         @default(0)
  level           Int         @default(0) // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean     @default(true)
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@unique([hospitalId, categoryCode])
  @@index([hospitalId])
  @@index([isActive])
  @@map("drug_categories")
}

model DrugInteraction {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  drug1Id         String      // ‡∏¢‡∏≤‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà 1
  drug1           Drug        @relation("Drug1Interactions", fields: [drug1Id], references: [id], onDelete: Cascade)
  drug2Id         String      // ‡∏¢‡∏≤‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà 2
  drug2           Drug        @relation("Drug2Interactions", fields: [drug2Id], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏è‡∏¥‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤
  interactionType String      // "CONTRAINDICATED", "MAJOR", "MODERATE", "MINOR"
  severity        String      // "CRITICAL", "HIGH", "MEDIUM", "LOW"
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
  description     String      // ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏õ‡∏è‡∏¥‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤
  mechanism       String?     // ‡∏Å‡∏•‡πÑ‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏è‡∏¥‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤
  clinicalEffect  String?     // ‡∏ú‡∏•‡∏ó‡∏≤‡∏á‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å
  management      String?     // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
  
  // ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  source          String?     // ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  referenceUrl    String?     // URL ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
  evidenceLevel   String?     // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean     @default(true)
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@unique([hospitalId, drug1Id, drug2Id])
  @@index([hospitalId])
  @@index([drug1Id])
  @@index([drug2Id])
  @@index([severity])
  @@map("drug_interactions")
}

model DrugAllergen {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  drugId          String
  drug            Drug        @relation("DrugAllergens", fields: [drugId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ
  allergenName    String      // ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ
  allergenType    String      // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: "ACTIVE_INGREDIENT", "EXCIPIENT", "PRESERVATIVE", "DYE"
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á
  severity        String      // "MILD", "MODERATE", "SEVERE", "LIFE_THREATENING"
  
  // ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£
  symptoms        String?     // ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
  management      String?     // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
  alternatives    String?     // ‡∏¢‡∏≤‡∏ó‡∏î‡πÅ‡∏ó‡∏ô
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean     @default(true)
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@unique([hospitalId, drugId, allergenName])
  @@index([hospitalId])
  @@index([drugId])
  @@index([allergenName])
  @@map("drug_allergens")
}

// ==========================================
// INVENTORY
// ==========================================

// prisma/schemas/inventory.prisma
// Inventory Management Schema
// ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Hospital Pharmacy System

enum TransactionType {
  RECEIVE         // ‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡∏à‡∏≤‡∏Å‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå
  DISPENSE        // ‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏ú‡∏ô‡∏Å
  TRANSFER_OUT    // ‡πÇ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏Ñ‡∏•‡∏±‡∏á‡∏≠‡∏∑‡πà‡∏ô
  TRANSFER_IN     // ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏≠‡∏∑‡πà‡∏ô
  ADJUST_INCREASE // ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡∏û‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°)
  ADJUST_DECREASE // ‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏î (‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡∏û‡∏ö‡∏•‡∏î, ‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢)
  RETURN          // ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≤‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å
  DISPOSE         // ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏¢‡∏≤‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏/‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢
  RESERVE         // ‡∏à‡∏≠‡∏á‡∏¢‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å
  UNRESERVE       // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
  QUARANTINE      // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏Å‡∏Å‡∏±‡∏ô
  RELEASE_QUARANTINE // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏Å‡∏Å‡∏±‡∏ô
  THEFT           // ‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢/‡∏ñ‡∏π‡∏Å‡∏Ç‡πÇ‡∏°‡∏¢
  DAMAGE          // ‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤
}

model StockTransaction {
  id               String          @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏´‡∏•‡∏±‡∏Å
  hospitalId       String
  warehouseId      String
  warehouse        Warehouse       @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  drugId           String
  drug             Drug            @relation(fields: [drugId], references: [id], onDelete: Cascade)
  stockCardId      String
  stockCard        StockCard       @relation(fields: [stockCardId], references: [id], onDelete: Cascade)
  batchId          String?
  batch            StockBatch?     @relation(fields: [batchId], references: [id], onDelete: SetNull)
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
  transactionType  TransactionType
  quantity         Int             // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (+/-)
  unitCost         Decimal         // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢
  totalCost        Decimal         // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°
  
  // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏á
  stockBefore      Int             // ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
  stockAfter       Int             // ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
  
  // ‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
  referenceDocument String?        // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (PO, REQ, etc.)
  referenceId      String?         // ID ‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
  notes            String?         // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  
  // ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö TRANSFER)
  fromWarehouseId  String?         // ‡∏Ñ‡∏•‡∏±‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á
  fromWarehouse    Warehouse?      @relation("TransferFrom", fields: [fromWarehouseId], references: [id], onDelete: SetNull)
  toWarehouseId    String?         // ‡∏Ñ‡∏•‡∏±‡∏á‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
  toWarehouse      Warehouse?      @relation("TransferTo", fields: [toWarehouseId], references: [id], onDelete: SetNull)
  
  // ‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  performedBy      String
  performer        User            @relation(fields: [performedBy], references: [id], onDelete: Restrict)
  
  // ‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)
  requiresApproval Boolean         @default(false)
  approvedBy       String?
  approvedAt       DateTime?
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å
  requisitionId    String?
  requisition      Requisition?    @relation(fields: [requisitionId], references: [id], onDelete: SetNull)
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  isSystemGenerated Boolean        @default(false) // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  ipAddress        String?
  userAgent        String?
  
  // Audit fields
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  
  @@index([hospitalId, warehouseId])
  @@index([drugId])
  @@index([stockCardId])
  @@index([transactionType])
  @@index([createdAt])
  @@index([performedBy])
  @@index([requisitionId])
  @@map("stock_transactions")
}

enum BatchStatus {
  ACTIVE          // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
  QUARANTINE      // ‡∏Å‡∏±‡∏Å‡∏Å‡∏±‡∏ô
  EXPIRED         // ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
  RECALLED        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏∑‡∏ô
  DAMAGED         // ‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢
  DISPOSED        // ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß
}

model StockBatch {
  id              String        @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  stockCardId     String
  stockCard       StockCard     @relation(fields: [stockCardId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• batch
  batchNumber     String        // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç batch
  manufacturingDate DateTime?   // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï
  expiryDate      DateTime      // ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
  
  // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å
  initialQty      Int           // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  currentQty      Int           // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
  reservedQty     Int           @default(0) // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á
  availableQty    Int           // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ (computed: currentQty - reservedQty)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠
  supplierId      String?       // ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå
  purchaseOrderId String?       // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç PO
  invoiceNo       String?       // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ
  
  // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
  receivedDate    DateTime      // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤
  firstUsedDate   DateTime?     // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  status          BatchStatus   @default(ACTIVE)
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û
  qcStatus        String?       // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ QC: "PENDING", "PASSED", "FAILED"
  qcDate          DateTime?     // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö QC
  qcNotes         String?       // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ QC
  
  // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö
  storageLocation String?       // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏Å‡πá‡∏ö
  storageCondition String?      // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö
  
  // Audit fields
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // Relations - ‡πÄ‡∏û‡∏¥‡πà‡∏° inverse relations
  transactions    StockTransaction[]
  stockCountItems StockCountItem[]
  
  @@unique([hospitalId, stockCardId, batchNumber])
  @@index([hospitalId, expiryDate])
  @@index([status])
  @@map("stock_batches")
}

model StockCard {
  id              String        @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital      @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  drugId          String
  drug            Drug          @relation(fields: [drugId], references: [id], onDelete: Cascade)
  warehouseId     String
  warehouse       Warehouse     @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  
  // ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î
  cardNumber      String        @unique // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å
  
  // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å
  currentStock    Int           @default(0)
  reservedStock   Int           @default(0)
  availableStock  Int           @default(0) // currentStock - reservedStock
  
  // ‡∏à‡∏∏‡∏î‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
  reorderPoint    Int           @default(0)
  reorderQty      Int           @default(0)
  maxStock        Int?          // ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
  minStock        Int?          // ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î
  
  // ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô
  averageCost     Decimal       @default(0) // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
  lastCost        Decimal       @default(0) // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  totalValue      Decimal       @default(0) // ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  lastIssueDate   DateTime?     // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  lastReceiveDate DateTime?     // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  monthlyUsage    Int           @default(0) // ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean       @default(true)
  isControlled    Boolean       @default(false) // ‡∏¢‡∏≤‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
  isNarcotic      Boolean       @default(false) // ‡∏¢‡∏≤‡πÄ‡∏™‡∏û‡∏ï‡∏¥‡∏î
  
  // ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
  lowStockAlert   Boolean       @default(false)
  expiryAlert     Boolean       @default(false)
  overStockAlert  Boolean       @default(false)
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  notes           String?
  
  // Audit fields
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // Relations
  batches         StockBatch[]
  transactions    StockTransaction[]
  stockCounts     StockCountItem[]
  requisitionItems RequisitionItem[]
  
  @@unique([hospitalId, drugId, warehouseId])
  @@index([hospitalId, warehouseId])
  @@index([drugId])
  @@index([currentStock])
  @@index([isActive])
  @@map("stock_cards")
}

enum CountStatus {
  PLANNED         // ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÅ‡∏•‡πâ‡∏ß
  IN_PROGRESS     // ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏±‡∏ö
  COMPLETED       // ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
  VERIFIED        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß
  ADJUSTED        // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß
  CANCELLED       // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
}

model StockCount {
  id              String        @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital      @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  warehouseId     String
  warehouse       Warehouse     @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö
  countNumber     String        @unique // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö
  countType       String        // "FULL", "PARTIAL", "CYCLE", "SPOT"
  reason          String?       // ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö
  
  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£
  scheduledDate   DateTime      // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ô‡∏±‡∏ö
  startedAt       DateTime?     // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö
  completedAt     DateTime?     // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  status          CountStatus   @default(PLANNED)
  
  // ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
  countedBy       String
  counter         User          @relation("StockCounter", fields: [countedBy], references: [id], onDelete: Restrict)
  verifiedBy      String?
  verifier        User?         @relation("StockCountVerifier", fields: [verifiedBy], references: [id], onDelete: Restrict)
  
  // ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
  totalItems      Int           @default(0)
  itemsWithVariance Int         @default(0) // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á
  totalVarianceValue Decimal    @default(0) // ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏°
  
  // ‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  requiresApproval Boolean      @default(false)
  approvedBy      String?
  approvedAt      DateTime?
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  notes           String?
  
  // Audit fields
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // Relations
  items           StockCountItem[]
  
  @@index([hospitalId, warehouseId])
  @@index([countedBy])
  @@index([status])
  @@index([scheduledDate])
  @@map("stock_counts")
}

model StockCountItem {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  stockCountId    String
  stockCount      StockCount  @relation(fields: [stockCountId], references: [id], onDelete: Cascade)
  stockCardId     String
  stockCard       StockCard   @relation(fields: [stockCardId], references: [id], onDelete: Cascade)
  batchId         String?
  batch           StockBatch? @relation(fields: [batchId], references: [id], onDelete: SetNull)
  
  // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ
  systemQty       Int         // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
  countedQty      Int         // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ
  variance        Int         // ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á (countedQty - systemQty)
  varianceValue   Decimal     @default(0) // ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  isVerified      Boolean     @default(false)
  verificationNotes String?
  
  // ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á
  varianceReason  String?     // "DAMAGE", "THEFT", "EXPIRED", "MISPLACED", "SYSTEM_ERROR", "OTHER"
  adjustmentRequired Boolean  @default(false)
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  countedAt       DateTime?   // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö
  verifiedAt      DateTime?   // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  notes           String?
  
  @@index([stockCountId])
  @@index([stockCardId])
  @@map("stock_count_items")
}

// ==========================================
// REQUISITIONS
// ==========================================

// prisma/schemas/requisitions.prisma
// Requisition Management Schema
// ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Hospital Pharmacy System

enum RequisitionStatus {
  DRAFT           // ‡∏£‡πà‡∏≤‡∏á
  SUBMITTED       // ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
  UNDER_REVIEW    // ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  APPROVED        // ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
  PARTIALLY_FILLED // ‡∏à‡πà‡∏≤‡∏¢‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
  COMPLETED       // ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
  CANCELLED       // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
  REJECTED        // ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
}

enum RequisitionType {
  REGULAR         // ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏õ‡∏Å‡∏ï‡∏¥
  EMERGENCY       // ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô
  SCHEDULED       // ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤
  RETURN          // ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≤
}

enum RequisitionPriority {
  LOW             // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ï‡πà‡∏≥
  NORMAL          // ‡∏õ‡∏Å‡∏ï‡∏¥
  HIGH            // ‡∏™‡∏π‡∏á
  URGENT          // ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô
}

model Requisition {
  id              String              @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏´‡∏•‡∏±‡∏Å
  hospitalId      String
  hospital        Hospital            @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡πÅ‡∏ú‡∏ô‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å
  requestingDepartmentId String
  requestingDepartment   Department   @relation("RequestingDepartment", fields: [requestingDepartmentId], references: [id], onDelete: Cascade)
  
  // ‡∏Ñ‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢
  fulfillmentWarehouseId String
  fulfillmentWarehouse   Warehouse    @relation("FulfillmentWarehouse", fields: [fulfillmentWarehouseId], references: [id], onDelete: Cascade)
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å
  requisitionNumber   String          @unique
  referenceNumber     String?         // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
  
  // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  type                RequisitionType
  status              RequisitionStatus @default(DRAFT)
  priority            RequisitionPriority @default(NORMAL)
  
  // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
  requestedDate       DateTime        @default(now())
  requiredDate        DateTime        // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  approvedDate        DateTime?       // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  fulfilledDate       DateTime?       // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏™‡∏£‡πá‡∏à
  
  // ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
  requesterId         String
  requester           User            @relation("RequesterRelation", fields: [requesterId], references: [id], onDelete: Restrict)
  approverId          String?
  approver            User?           @relation("ApproverRelation", fields: [approverId], references: [id], onDelete: Restrict)
  fulfillerId         String?
  fulfiller           User?           @relation("FulfillerRelation", fields: [fulfillerId], references: [id], onDelete: Restrict)
  
  // ‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å
  totalItems          Int             @default(0)
  totalRequestedQty   Int             @default(0)
  totalApprovedQty    Int             @default(0)
  totalFulfilledQty   Int             @default(0)
  estimatedValue      Decimal         @default(0)
  actualValue         Decimal         @default(0)
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  requestNotes        String?         // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å
  approvalNotes       String?         // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  fulfillmentNotes    String?         // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢
  rejectionReason     String?         // ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  isUrgent            Boolean         @default(false)
  isRecurring         Boolean         @default(false)
  recurringPattern    String?         // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏õ‡∏£‡∏∞‡∏à‡∏≥
  
  // Audit fields
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  
  // ================================
  // RELATIONS (Fixed opposite fields)
  // ================================
  items               RequisitionItem[]
  workflow            RequisitionWorkflow[]
  transactions        StockTransaction[] // Fixed: ‡πÄ‡∏û‡∏¥‡πà‡∏° relation ‡∏Å‡∏•‡∏±‡∏ö
  attachments         RequisitionAttachment[]
  
  @@index([hospitalId])
  @@index([requestingDepartmentId])
  @@index([fulfillmentWarehouseId])
  @@index([status])
  @@index([requestedDate])
  @@index([priority])
  @@map("requisitions")
}

model RequisitionItem {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  requisitionId   String
  requisition     Requisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)
  drugId          String
  drug            Drug        @relation(fields: [drugId], references: [id], onDelete: Cascade)
  stockCardId     String?
  stockCard       StockCard?  @relation(fields: [stockCardId], references: [id], onDelete: SetNull)
  
  // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
  requestedQty    Int         // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å
  approvedQty     Int?        // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  fulfilledQty    Int         @default(0) // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß
  
  // ‡∏£‡∏≤‡∏Ñ‡∏≤
  unitCost        Decimal?    // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢
  totalCost       Decimal     @default(0) // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
  status          String      @default("PENDING") // "PENDING", "APPROVED", "PARTIAL", "COMPLETED", "CANCELLED"
  
  // ‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏ batch (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢)
  preferredBatch  String?     // batch ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  actualBatches   Json?       // batch ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á (array of {batchId, quantity})
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  requestNotes    String?     // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å
  approvalNotes   String?     // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  fulfillmentNotes String?    // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([requisitionId])
  @@index([drugId])
  @@index([status])
  @@map("requisition_items")
}

enum WorkflowAction {
  CREATE          // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å
  SUBMIT          // ‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å
  REVIEW          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  APPROVE         // ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  REJECT          // ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
  FULFILL         // ‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤
  PARTIAL_FULFILL // ‡∏à‡πà‡∏≤‡∏¢‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
  COMPLETE        // ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
  CANCEL          // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
  REQUEST_INFO    // ‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  PROVIDE_INFO    // ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
}

model RequisitionWorkflow {
  id              String          @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  requisitionId   String
  requisition     Requisition     @relation(fields: [requisitionId], references: [id], onDelete: Cascade)
  userId          String
  user            User            @relation(fields: [userId], references: [id], onDelete: Restrict)
  
  // ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  action          WorkflowAction
  fromStatus      RequisitionStatus?
  toStatus        RequisitionStatus?
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
  comments        String?
  attachments     Json?           // array of file paths/URLs
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  processedAt     DateTime        @default(now())
  ipAddress       String?
  userAgent       String?
  
  @@index([requisitionId])
  @@index([userId])
  @@index([action])
  @@index([processedAt])
  @@map("requisition_workflows")
}

model RequisitionAttachment {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  requisitionId   String
  requisition     Requisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)
  uploadedBy      String
  uploader        User        @relation(fields: [uploadedBy], references: [id], onDelete: Restrict)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå
  fileName        String
  originalName    String
  fileSize        Int
  mimeType        String
  filePath        String      // path in storage
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
  description     String?
  category        String?     // "PRESCRIPTION", "AUTHORIZATION", "SUPPORTING_DOC", "OTHER"
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean     @default(true)
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([requisitionId])
  @@index([uploadedBy])
  @@map("requisition_attachments")
}

model RequisitionTemplate {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  departmentId    String
  department      Department  @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  createdBy       String
  creator         User        @relation(fields: [createdBy], references: [id], onDelete: Restrict)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï
  templateName    String
  description     String?
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
  type            RequisitionType
  priority        RequisitionPriority @default(NORMAL)
  isRecurring     Boolean     @default(false)
  recurringPattern String?    // "DAILY", "WEEKLY", "MONTHLY", "CUSTOM"
  
  // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤ (JSON)
  items           Json        // array of {drugId, requestedQty, notes}
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive        Boolean     @default(true)
  
  // ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  usageCount      Int         @default(0)
  lastUsedAt      DateTime?
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([hospitalId])
  @@index([departmentId])
  @@index([createdBy])
  @@map("requisition_templates")
}

// ==========================================
// SUPPLIERS
// ==========================================

// prisma/schemas/suppliers.prisma
// Supplier Management Schema
// ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Hospital Pharmacy System

enum SupplierStatus {
  PENDING     // ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  ACTIVE      // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
  SUSPENDED   // ‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  INACTIVE    // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  BLACKLISTED // ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏î‡∏≥
}

enum SupplierType {
  PHARMACEUTICAL  // ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏¢‡∏≤
  MEDICAL_DEVICE  // ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå
  CONSUMABLE     // ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á
  LABORATORY     // ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£
  OTHER          // ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
}

model Supplier {
  id              String          @id @default(uuid())
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå
  supplierCode    String          @unique // ‡∏£‡∏´‡∏±‡∏™‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå
  name            String
  nameEn          String?         // ‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
  
  // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  type            SupplierType
  status          SupplierStatus  @default(ACTIVE)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
  taxId           String?         // ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ
  registrationNo  String?         // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
  licenseNo       String?         // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
  licenseExpiry   DateTime?       // ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
  
  // ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
  address         String
  district        String?         // ‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á
  subDistrict     String?         // ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï
  province        String
  postalCode      String?
  country         String          @default("Thailand")
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
  phone           String?
  fax             String?
  email           String?
  website         String?
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
  paymentTerms    String?         // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (30 days, COD, etc.)
  creditLimit     Decimal?        // ‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï
  currency        String          @default("THB")
  
  // ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
  rating          Decimal?        // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (1-5)
  qualityScore    Decimal?        // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û
  deliveryScore   Decimal?        // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö
  serviceScore    Decimal?        // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  notes           String?
  internalNotes   String?         // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  lastOrderDate   DateTime?       // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  totalOrders     Int             @default(0)
  totalValue      Decimal         @default(0)
  
  // Audit fields
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  // ================================
  // RELATIONS (Fixed opposite fields)
  // ================================
  contacts        SupplierContact[]
  products        SupplierProduct[]
  purchaseOrders  PurchaseOrder[]
  goodsReceipts   GoodsReceipt[]  // Fixed: ‡πÄ‡∏û‡∏¥‡πà‡∏° relation ‡∏Å‡∏•‡∏±‡∏ö
  evaluations     SupplierEvaluation[]
  
  @@index([supplierCode])
  @@index([status])
  @@index([type])
  @@map("suppliers")
}

model SupplierContact {
  id          String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  supplierId  String
  supplier    Supplier    @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
  name        String
  position    String?     // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
  department  String?     // ‡πÅ‡∏ú‡∏ô‡∏Å
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
  phone       String?
  mobile      String?
  email       String?
  fax         String?
  
  // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
  contactType String      // "PRIMARY", "SECONDARY", "SALES", "TECHNICAL", "BILLING", "EMERGENCY"
  isPrimary   Boolean     @default(false)
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isActive    Boolean     @default(true)
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  lastContactDate DateTime?
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  notes       String?
  
  // Audit fields
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  @@index([supplierId])
  @@map("supplier_contacts")
}

model SupplierProduct {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  supplierId      String
  supplier        Supplier    @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  drugId          String
  drug            Drug        @relation(fields: [drugId], references: [id], onDelete: Cascade)
  
  // ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå
  supplierProductCode String?
  supplierBarcode String?
  
  // ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
  unitPrice       Decimal
  unitOfMeasure   String      // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö
  packSize        Int?        // ‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏û‡πá‡∏Ñ
  minimumOrderQty Int?        // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥
  
  // ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
  leadTimeDays    Int?        // ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö (‡∏ß‡∏±‡∏ô)
  availability    String?     // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå
  manufacturerLot String?     // ‡∏£‡∏´‡∏±‡∏™ lot ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï
  expiryPeriod    Int?        // ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
  storageCondition String?    // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  isPreferred     Boolean     @default(false) // ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å
  isActive        Boolean     @default(true)
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  lastOrderDate   DateTime?
  lastPurchasePrice Decimal?
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@unique([supplierId, drugId])
  @@index([supplierId])
  @@index([drugId])
  @@map("supplier_products")
}

enum PurchaseOrderStatus {
  DRAFT           // ‡∏£‡πà‡∏≤‡∏á
  SUBMITTED       // ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
  CONFIRMED       // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß
  PARTIALLY_RECEIVED // ‡∏£‡∏±‡∏ö‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
  COMPLETED       // ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
  CANCELLED       // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
  ON_HOLD         // ‡∏û‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
}

model PurchaseOrder {
  id              String              @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital            @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  supplierId      String
  supplier        Supplier            @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
  poNumber        String              @unique
  supplierRef     String?             // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  status          PurchaseOrderStatus @default(DRAFT)
  
  // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
  orderDate       DateTime            @default(now())
  requiredDate    DateTime            // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö
  expectedDate    DateTime?           // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
  confirmedDate   DateTime?           // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
  
  // ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤
  subtotal        Decimal             @default(0)
  discountAmount  Decimal             @default(0)
  taxAmount       Decimal             @default(0)
  totalAmount     Decimal             @default(0)
  
  // ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
  orderedBy       String
  orderer         User                @relation("POOrderer", fields: [orderedBy], references: [id], onDelete: Restrict)
  approvedBy      String?
  approver        User?               @relation("POApprover", fields: [approvedBy], references: [id], onDelete: Restrict)
  
  // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
  paymentTerms    String?
  deliveryTerms   String?
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  notes           String?
  internalNotes   String?
  
  // Audit fields
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  // Relations
  items           PurchaseOrderItem[]
  goodsReceipts   GoodsReceipt[]
  
  @@index([hospitalId, supplierId])
  @@index([orderDate])
  @@index([status])
  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id              String        @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  purchaseOrderId String
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  drugId          String
  drug            Drug          @relation(fields: [drugId], references: [id], onDelete: Cascade)
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
  description     String?       // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  specification   String?       // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ
  
  // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤
  quantity        Int
  unitPrice       Decimal
  discountPercent Decimal       @default(0)
  discountAmount  Decimal       @default(0)
  lineTotal       Decimal
  
  // ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö
  requestedDate   DateTime?     // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  deliveredQty    Int           @default(0) // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  status          String        @default("PENDING") // "PENDING", "PARTIAL", "COMPLETED", "CANCELLED"
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  notes           String?
  
  // Audit fields
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // ================================
  // RELATIONS (Fixed opposite fields)
  // ================================
  goodsReceiptItems GoodsReceiptItem[] // Fixed: ‡πÄ‡∏û‡∏¥‡πà‡∏° relation ‡∏Å‡∏•‡∏±‡∏ö
  
  @@index([purchaseOrderId])
  @@index([drugId])
  @@map("purchase_order_items")
}

enum ReceiptStatus {
  PENDING     // ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  VERIFIED    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß
  APPROVED    // ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
  REJECTED    // ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
  CANCELLED   // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
}

model GoodsReceipt {
  id              String        @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital      @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  supplierId      String
  supplier        Supplier      @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  purchaseOrderId String?
  purchaseOrder   PurchaseOrder? @relation(fields: [purchaseOrderId], references: [id], onDelete: SetNull)
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
  receiptNumber   String        @unique
  supplierInvoice String?       // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå
  deliveryNote    String?       // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á
  
  // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
  receivedDate    DateTime      @default(now())
  invoiceDate     DateTime?
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  status          ReceiptStatus @default(PENDING)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö
  totalItems      Int           @default(0)
  totalAmount     Decimal       @default(0)
  
  // ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
  receivedBy      String
  receiver        User          @relation("GRReceiver", fields: [receivedBy], references: [id], onDelete: Restrict)
  verifiedBy      String?
  verifier        User?         @relation("GRVerifier", fields: [verifiedBy], references: [id], onDelete: SetNull)
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  notes           String?
  discrepancyNotes String?      // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥
  
  // Audit fields
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // Relations
  items           GoodsReceiptItem[]
  
  @@index([hospitalId, supplierId])
  @@index([receivedDate])
  @@index([status])
  @@map("goods_receipts")
}

model GoodsReceiptItem {
  id              String        @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  goodsReceiptId  String
  goodsReceipt    GoodsReceipt  @relation(fields: [goodsReceiptId], references: [id], onDelete: Cascade)
  drugId          String
  drug            Drug          @relation(fields: [drugId], references: [id], onDelete: Cascade)
  purchaseOrderItemId String?
  purchaseOrderItem PurchaseOrderItem? @relation(fields: [purchaseOrderItemId], references: [id], onDelete: SetNull)
  
  // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
  orderedQty      Int?          // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á (‡∏à‡∏≤‡∏Å PO)
  receivedQty     Int           // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á
  acceptedQty     Int           // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö
  rejectedQty     Int           @default(0) // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• batch
  batchNumber     String
  manufacturingDate DateTime?
  expiryDate      DateTime
  
  // ‡∏£‡∏≤‡∏Ñ‡∏≤
  unitCost        Decimal
  totalCost       Decimal
  
  // ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
  rejectionReason String?
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û
  qcStatus        String?       // "PENDING", "PASSED", "FAILED"
  qcNotes         String?
  
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  notes           String?
  
  // Audit fields
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@index([goodsReceiptId])
  @@index([drugId])
  @@map("goods_receipt_items")
}

model SupplierEvaluation {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  supplierId      String
  supplier        Supplier    @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  evaluatedBy     String
  evaluator       User        @relation(fields: [evaluatedBy], references: [id], onDelete: Restrict)
  
  // ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
  periodStart     DateTime
  periodEnd       DateTime
  
  // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (1-5)
  qualityScore    Decimal     // ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
  deliveryScore   Decimal     // ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö‡∏ï‡∏£‡∏á‡πÄ‡∏ß‡∏•‡∏≤
  serviceScore    Decimal     // ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
  priceScore      Decimal     // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤
  responseScore   Decimal     // ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á
  overallScore    Decimal     // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô
  strengths       String?     // ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á
  weaknesses      String?     // ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô
  recommendations String?     // ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
  
  // ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  actionRequired  Boolean     @default(false)
  followUpDate    DateTime?
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  status          String      @default("DRAFT") // "DRAFT", "SUBMITTED", "APPROVED"
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([supplierId])
  @@index([hospitalId])
  @@index([periodStart, periodEnd])
  @@map("supplier_evaluations")
}

// ==========================================
// ANALYTICS
// ==========================================

// prisma/schemas/analytics.prisma
// Analytics and Reporting Schema
// ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Hospital Pharmacy System

model Report {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  requestedBy     String
  requester       User        @relation(fields: [requestedBy], references: [id], onDelete: Restrict)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
  title           String
  description     String?
  reportType      String      // "STOCK", "REQUISITION", "SUPPLIER", "COMPLIANCE", etc.
  
  // ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå
  parameters      Json?       // ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
  filterCriteria  Json?       // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
  
  // ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á
  status          String      @default("PENDING") // "PENDING", "GENERATING", "COMPLETED", "FAILED"
  generatedAt     DateTime?   // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à
  filePath        String?     // path ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
  fileSize        Int?        // ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå (bytes)
  
  // ‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
  downloadCount   Int         @default(0)
  lastDownloaded  DateTime?
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([hospitalId])
  @@index([requestedBy])
  @@index([reportType])
  @@index([status])
  @@map("reports")
}

model Dashboard {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  userId          String
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• dashboard
  name            String
  description     String?
  layout          Json        // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á widgets
  widgets         Json        // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ widgets ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
  
  // ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  isDefault       Boolean     @default(false) // dashboard ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  isPublic        Boolean     @default(false) // ‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
  viewCount       Int         @default(0)
  lastViewedAt    DateTime?
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([hospitalId])
  @@index([userId])
  @@map("dashboards")
}

model SystemUsage {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  userId          String?
  user            User?       @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  feature         String      // ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
  action          String      // ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥
  sessionId       String?     // session ID
  
  // ‡πÄ‡∏ß‡∏•‡∏≤
  startTime       DateTime    @default(now())
  endTime         DateTime?
  duration        Int?        // ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ
  ipAddress       String?
  userAgent       String?
  platform        String?     // "web", "mobile", "desktop"
  
  // ‡πÄ‡∏°‡∏ï‡∏£‡∏¥‡∏Å
  clicks          Int         @default(0)
  pageViews       Int         @default(0)
  dataTransferred Int         @default(0) // bytes
  
  @@index([hospitalId])
  @@index([userId])
  @@index([feature])
  @@index([startTime])
  @@map("system_usage")
}

// ==========================================
// AUDIT
// ==========================================

// prisma/schemas/audit.prisma
// Audit and Compliance Management Schema (Enhanced for User Approval)
// ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö

enum AuditAction {
  CREATE          // ‡∏™‡∏£‡πâ‡∏≤‡∏á
  READ            // ‡∏≠‡πà‡∏≤‡∏ô
  UPDATE          // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  DELETE          // ‡∏•‡∏ö
  LOGIN           // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
  LOGOUT          // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
  APPROVE         // ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  REJECT          // ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
  TRANSFER        // ‡πÇ‡∏≠‡∏ô
  RECEIVE         // ‡∏£‡∏±‡∏ö
  DISPENSE        // ‡∏à‡πà‡∏≤‡∏¢
  ADJUST          // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á
  EXPORT          // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  IMPORT          // ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  PRINT           // ‡∏û‡∏¥‡∏°‡∏û‡πå
  EMAIL           // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•
  
  // User Management Actions
  USER_APPROVED   // ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  USER_REJECTED   // ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  USER_SUSPENDED  // ‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  USER_ACTIVATED  // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  ROLE_CHANGED    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó
  STATUS_CHANGED  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
}

model AuditLog {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  userId          String?
  user            User?       @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  // ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  action          AuditAction
  entityType      String      // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (User, Drug, StockCard, etc.)
  entityId        String?     // ID ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
  description     String
  oldValues       Json?       // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UPDATE, DELETE)
  newValues       Json?       // ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CREATE, UPDATE)
  details         Json?       // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  ipAddress       String?
  userAgent       String?
  sessionId       String?
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  severity        String      @default("INFO") // "LOW", "INFO", "WARNING", "ERROR", "CRITICAL"
  category        String?     // ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  tags            String[]    // ‡πÅ‡∏ó‡πá‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°
  
  // ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤
  retentionDate   DateTime?   // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ
  isArchived      Boolean     @default(false)
  
  // Audit fields
  timestamp       DateTime    @default(now())
  
  @@index([hospitalId, userId])
  @@index([action])
  @@index([entityType])
  @@index([timestamp])
  @@index([severity])
  @@map("audit_logs")
}

model DataAccessLog {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  userId          String
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  resourceType    String      // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  resourceId      String?     // ID ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  operation       String      // ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (READ, SEARCH, EXPORT, etc.)
  
  // ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
  success         Boolean
  errorMessage    String?
  recordCount     Int?        // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  ipAddress       String?
  userAgent       String?
  requestPath     String?     // API path
  queryParams     Json?       // query parameters
  
  // ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
  responseTime    Int?        // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á (ms)
  dataSize        Int?        // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (bytes)
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
  riskLevel       String      @default("LOW") // "LOW", "MEDIUM", "HIGH", "CRITICAL"
  sensitiveData   Boolean     @default(false) // ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  
  // Audit fields
  timestamp       DateTime    @default(now())
  
  @@index([hospitalId, userId])
  @@index([resourceType])
  @@index([timestamp])
  @@index([success])
  @@index([riskLevel])
  @@map("data_access_logs")
}

enum ComplianceType {
  REGULATORY      // ‡∏Å‡∏é‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê
  INTERNAL        // ‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
  QUALITY         // ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û
  SAFETY          // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
  FINANCIAL       // ‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
  PRIVACY         // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
  SECURITY        // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
}

enum ComplianceStatus {
  COMPLIANT       // ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°
  NON_COMPLIANT   // ‡πÑ‡∏°‡πà‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°
  PARTIAL         // ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
  PENDING         // ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  UNDER_REVIEW    // ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô
}

model ComplianceCheck {
  id              String          @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital        @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  checkedBy       String
  checker         User            @relation("ComplianceChecker", fields: [checkedBy], references: [id], onDelete: Restrict)
  reviewedBy      String?
  reviewer        User?           @relation("ComplianceReviewer", fields: [reviewedBy], references: [id], onDelete: Restrict)
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  checkType       ComplianceType
  title           String
  description     String
  requirements    String          // ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥
  
  // ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  status          ComplianceStatus
  findings        String?         // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö
  recommendations String?         // ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
  
  // ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  actionRequired  Boolean         @default(false)
  actionPlan      String?         // ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  dueDate         DateTime?       // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  completedDate   DateTime?       // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à
  
  // ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
  riskLevel       String          @default("LOW") // "LOW", "MEDIUM", "HIGH", "CRITICAL"
  complianceScore Decimal?        // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏° (0-100)
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  nextCheckDate   DateTime?       // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ
  frequency       String?         // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  
  // ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
  evidenceFiles   Json?           // ‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô
  reportFile      String?         // ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
  
  // Audit fields
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([hospitalId])
  @@index([checkedBy])
  @@index([checkType])
  @@index([status])
  @@index([riskLevel])
  @@map("compliance_checks")
}

enum SubstanceAction {
  RECEIVE         // ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤
  DISPENSE        // ‡∏à‡πà‡∏≤‡∏¢
  TRANSFER        // ‡πÇ‡∏≠‡∏ô
  RETURN          // ‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô
  DISPOSE         // ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢
  COUNT           // ‡∏ô‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å
  ADJUST          // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á
  WASTE           // ‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢
}

model ControlledSubstanceLog {
  id              String          @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital        @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  drugId          String
  drug            Drug            @relation(fields: [drugId], references: [id], onDelete: Cascade)
  
  // ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
  handledBy       String
  handler         User            @relation("CSLHandler", fields: [handledBy], references: [id], onDelete: Restrict)
  witnessedBy     String?
  witness         User?           @relation("CSLWitness", fields: [witnessedBy], references: [id], onDelete: Restrict)
  authorizedBy    String?
  authorizer      User?           @relation("CSLAuthorizer", fields: [authorizedBy], references: [id], onDelete: Restrict)
  
  // ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  action          SubstanceAction
  quantity        Int
  unit            String
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• batch
  batchNumber     String?
  expiryDate      DateTime?
  
  // ‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
  referenceType   String?         // "PRESCRIPTION", "REQUISITION", "TRANSFER", "DISPOSAL"
  referenceId     String?         // ID ‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
  referenceNumber String?         // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà
  fromLocation    String?         // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á
  toLocation      String?         // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
  
  // ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤)
  patientId       String?         // ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢
  patientName     String?         // ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (encrypted)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  reason          String?         // ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
  notes           String?         // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  requiresWitness Boolean         @default(true)
  requiresAuth    Boolean         @default(false)
  
  // Audit fields
  timestamp       DateTime        @default(now())
  createdAt       DateTime        @default(now())
  
  @@index([hospitalId, drugId])
  @@index([handledBy])
  @@index([action])
  @@index([timestamp])
  @@map("controlled_substance_logs")
}

model InternalAudit {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  auditedBy       String
  auditor         User        @relation(fields: [auditedBy], references: [id], onDelete: Restrict)
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  auditTitle      String
  auditScope      String      // ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  auditPeriod     String      // ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  
  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£
  plannedDate     DateTime    // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô
  startDate       DateTime?   // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  endDate         DateTime?   // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
  
  // ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  status          String      @default("PLANNED") // "PLANNED", "IN_PROGRESS", "COMPLETED", "CANCELLED"
  overallRating   String?     // "EXCELLENT", "GOOD", "SATISFACTORY", "NEEDS_IMPROVEMENT", "UNSATISFACTORY"
  
  // ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
  keyFindings     String?     // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
  recommendations String?     // ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
  actionItems     Json?       // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  followUpDate    DateTime?   // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•
  isFollowUp      Boolean     @default(false)
  parentAuditId   String?     // ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
  
  // ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
  reportFile      String?     // ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
  attachments     Json?       // ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([hospitalId])
  @@index([auditedBy])
  @@index([status])
  @@index([plannedDate])
  @@map("internal_audits")
}

enum IncidentType {
  SECURITY_BREACH         // ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  UNAUTHORIZED_ACCESS     // ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
  DATA_CORRUPTION        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢
  SYSTEM_FAILURE         // ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πà‡∏°
  POLICY_VIOLATION       // ‡∏Å‡∏≤‡∏£‡∏•‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢
  SUSPICIOUS_ACTIVITY    // ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡πà‡∏≤‡∏™‡∏á‡∏™‡∏±‡∏¢
  MEDICATION_ERROR       // ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏≤
  INVENTORY_DISCREPANCY  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å
  OTHER                  // ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
}

enum IncidentSeverity {
  LOW                    // ‡∏ï‡πà‡∏≥
  MEDIUM                 // ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
  HIGH                   // ‡∏™‡∏π‡∏á
  CRITICAL               // ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï
}

enum IncidentStatus {
  REPORTED               // ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
  UNDER_INVESTIGATION    // ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô
  RESOLVED               // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
  CLOSED                 // ‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™
  ESCALATED              // ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á
}

model SecurityIncident {
  id              String          @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital        @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  reportedBy      String
  reporter        User            @relation("SecurityReporter", fields: [reportedBy], references: [id], onDelete: Restrict)
  suspectedUserId String?         // ‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏á‡∏™‡∏±‡∏¢
  suspectedUser   User?           @relation("SuspectedUser", fields: [suspectedUserId], references: [id], onDelete: Restrict)
  investigatedBy  String?
  investigator    User?           @relation("Investigator", fields: [investigatedBy], references: [id], onDelete: Restrict)
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå
  incidentType    IncidentType
  severity        IncidentSeverity
  status          IncidentStatus  @default(REPORTED)
  
  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
  title           String
  description     String
  affectedSystems String?         // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö
  affectedData    String?         // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  detectedAt      DateTime        // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå
  reportedAt      DateTime        @default(now())
  investigatedAt  DateTime?       // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô
  resolvedAt      DateTime?       // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  
  // ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
  rootCause       String?         // ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏´‡∏•‡∏±‡∏Å
  impact          String?         // ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö
  riskAssessment  String?         // ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
  
  // ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  immediateActions String?        // ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤
  correctiveActions String?       // ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  preventiveActions String?       // ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  isExternal      Boolean         @default(false) // ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å
  requiresReporting Boolean       @default(false) // ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
  reportedToAuth  Boolean         @default(false) // ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
  
  // ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
  evidenceFiles   Json?           // ‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô
  reportFile      String?         // ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
  
  // ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö
  financialImpact Decimal?        // ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
  operationalImpact String?       // ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô
  reputationalImpact String?      // ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•
  lessonsLearned  String?         // ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
  improvementsImplemented String? // ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  
  // ‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
  relatedIncidents Json?          // ‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
  externalReferences Json?        // ‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å
  
  // Audit fields
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([hospitalId])
  @@index([reportedBy])
  @@index([incidentType])
  @@index([severity])
  @@index([status])
  @@index([detectedAt])
  @@map("security_incidents")
}

// ==========================================
// NOTIFICATIONS
// ==========================================

// prisma/schemas/notifications.prisma
// Notification Management Schema
// ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Hospital Pharmacy System

enum NotificationType {
  STOCK_LOW           // ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥
  STOCK_OUT           // ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏´‡∏°‡∏î
  STOCK_EXPIRED       // ‡∏¢‡∏≤‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
  STOCK_EXPIRING      // ‡∏¢‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
  REQUISITION_PENDING // ‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
  REQUISITION_APPROVED // ‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
  REQUISITION_REJECTED // ‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
  PO_CREATED          // ‡∏™‡∏£‡πâ‡∏≤‡∏á PO ‡πÅ‡∏•‡πâ‡∏ß
  PO_APPROVED         // PO ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
  GOODS_RECEIVED      // ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß
  COMPLIANCE_ALERT    // ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°
  SECURITY_ALERT      // ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
  SYSTEM_MAINTENANCE  // ‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
  USER_CREATED        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
  PASSWORD_RESET      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
}

enum NotificationPriority {
  LOW                 // ‡∏ï‡πà‡∏≥
  NORMAL              // ‡∏õ‡∏Å‡∏ï‡∏¥
  HIGH                // ‡∏™‡∏π‡∏á
  URGENT              // ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô
}

enum NotificationStatus {
  PENDING             // ‡∏£‡∏≠‡∏™‡πà‡∏á
  SENT                // ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
  DELIVERED           // ‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß
  READ                // ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
  FAILED              // ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
}

model Notification {
  id              String              @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  hospitalId      String
  hospital        Hospital            @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
  type            NotificationType
  priority        NotificationPriority @default(NORMAL)
  title           String
  message         String
  
  // ‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
  referenceType   String?             // "DRUG", "REQUISITION", "PURCHASE_ORDER", etc.
  referenceId     String?             // ID ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
  
  // ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
  targetRoles     String[]            // ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
  targetUsers     Json?               // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (array of user IDs)
  targetDepartments Json?             // ‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (array of department IDs)
  
  // ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á
  sendEmail       Boolean             @default(false)
  sendSMS         Boolean             @default(false)
  sendPush        Boolean             @default(true)
  sendInApp       Boolean             @default(true)
  
  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£
  scheduledAt     DateTime?           // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á
  sentAt          DateTime?           // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏à‡∏£‡∏¥‡∏á
  expiresAt       DateTime?           // ‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  status          NotificationStatus  @default(PENDING)
  
  // ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  totalRecipients Int                 @default(0)
  readCount       Int                 @default(0)
  clickCount      Int                 @default(0)
  
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  metadata        Json?               // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  actionUrl       String?             // URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥
  
  // Audit fields
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  // Relations
  users           NotificationUser[]
  
  @@index([hospitalId])
  @@index([type])
  @@index([priority])
  @@index([status])
  @@index([scheduledAt])
  @@map("notifications")
}

model NotificationUser {
  id              String              @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  notificationId  String
  notification    Notification        @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  userId          String
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á
  emailSent       Boolean             @default(false)
  smsSent         Boolean             @default(false)
  pushSent        Boolean             @default(false)
  inAppSent       Boolean             @default(false)
  
  // ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô
  isRead          Boolean             @default(false)
  readAt          DateTime?
  
  // ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥
  isClicked       Boolean             @default(false)
  clickedAt       DateTime?
  
  // ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á
  deliveredAt     DateTime?
  failedAt        DateTime?
  failureReason   String?
  
  @@unique([notificationId, userId])
  @@index([userId])
  @@index([isRead])
  @@map("notification_users")
}

model NotificationPreference {
  id              String      @id @default(uuid())
  
  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  userId          String
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
  notificationType NotificationType
  
  // ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
  enableEmail     Boolean     @default(true)
  enableSMS       Boolean     @default(false)
  enablePush      Boolean     @default(true)
  enableInApp     Boolean     @default(true)
  
  // ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
  quietHoursStart String?     // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏á‡∏µ‡∏¢‡∏ö (HH:mm)
  quietHoursEnd   String?     // ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏á‡∏µ‡∏¢‡∏ö (HH:mm)
  weekendEnabled  Boolean     @default(true)
  
  // ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
  minimumPriority NotificationPriority @default(NORMAL)
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@unique([userId, notificationType])
  @@index([userId])
  @@map("notification_preferences")
}

// ==========================================
// SHARED ENUMS
// üîß Shared Enums - Foundation Layer
// ==========================================

// prisma/schemas/shared-enums.prisma
// Shared Enums Schema
// Enums ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÇ‡∏°‡∏î‡∏π‡∏• - ‡∏ï‡πâ‡∏≠‡∏á load ‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

// ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç - ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
enum Priority {
  LOW             // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ï‡πà‡∏≥
  NORMAL          // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏õ‡∏Å‡∏ï‡∏¥
  HIGH            // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏π‡∏á
  URGENT          // ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô
  CRITICAL        // ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï
}

// ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ - ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö
enum ApprovalStatus {
  PENDING         // ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  APPROVED        // ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
  REJECTED        // ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
  CANCELLED       // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
  EXPIRED         // ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤
}

// ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
enum ActiveStatus {
  ACTIVE          // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥
  INACTIVE        // ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
  SUSPENDED       // ‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  DELETED         // ‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß (soft delete)
}

// ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô
enum Currency {
  THB             // ‡∏ö‡∏≤‡∏ó‡πÑ‡∏ó‡∏¢
  USD             // ‡∏î‡∏≠‡∏•‡∏•‡∏≤‡∏£‡πå‡∏™‡∏´‡∏£‡∏±‡∏ê
  EUR             // ‡∏¢‡∏π‡πÇ‡∏£
  JPY             // ‡πÄ‡∏¢‡∏ô‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô
}

// ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ - ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
enum TimePeriod {
  HOURLY          // ‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
  DAILY           // ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
  WEEKLY          // ‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
  MONTHLY         // ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
  QUARTERLY       // ‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™
  YEARLY          // ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
}

// ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
enum DocumentType {
  PDF             // ‡πÑ‡∏ü‡∏•‡πå PDF
  EXCEL           // ‡πÑ‡∏ü‡∏•‡πå Excel
  WORD            // ‡πÑ‡∏ü‡∏•‡πå Word
  IMAGE           // ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
  CSV             // ‡πÑ‡∏ü‡∏•‡πå CSV
  JSON            // ‡πÑ‡∏ü‡∏•‡πå JSON
  XML             // ‡πÑ‡∏ü‡∏•‡πå XML
  OTHER           // ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
}
