// prisma/schemas/analytics.prisma
// Analytics and Reporting Schema
// ระบบการวิเคราะห์และรายงานสำหรับ Hospital Pharmacy System

model Report {
  id              String      @id @default(uuid())
  
  // ความสัมพันธ์
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  requestedBy     String
  requester       User        @relation(fields: [requestedBy], references: [id], onDelete: Restrict)
  
  // ข้อมูลรายงาน
  title           String
  description     String?
  reportType      String      // "STOCK", "REQUISITION", "SUPPLIER", "COMPLIANCE", etc.
  
  // พารามิเตอร์
  parameters      Json?       // พารามิเตอร์การสร้างรายงาน
  filterCriteria  Json?       // เงื่อนไขการกรอง
  
  // การสร้าง
  status          String      @default("PENDING") // "PENDING", "GENERATING", "COMPLETED", "FAILED"
  generatedAt     DateTime?   // เวลาที่สร้างเสร็จ
  filePath        String?     // path ของไฟล์รายงาน
  fileSize        Int?        // ขนาดไฟล์ (bytes)
  
  // การดาวน์โหลด
  downloadCount   Int         @default(0)
  lastDownloaded  DateTime?
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([hospitalId])
  @@index([requestedBy])
  @@index([reportType])
  @@index([status])
  @@map("reports")
}

model Dashboard {
  id              String      @id @default(uuid())
  
  // ความสัมพันธ์
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  userId          String
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ข้อมูล dashboard
  name            String
  description     String?
  layout          Json        // การจัดวาง widgets
  widgets         Json        // รายการ widgets และการตั้งค่า
  
  // การใช้งาน
  isDefault       Boolean     @default(false) // dashboard เริ่มต้น
  isPublic        Boolean     @default(false) // แชร์ให้ผู้อื่นใช้ได้
  viewCount       Int         @default(0)
  lastViewedAt    DateTime?
  
  // Audit fields
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([hospitalId])
  @@index([userId])
  @@map("dashboards")
}

model SystemUsage {
  id              String      @id @default(uuid())
  
  // ความสัมพันธ์
  hospitalId      String
  hospital        Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  userId          String?
  user            User?       @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  // ข้อมูลการใช้งาน
  feature         String      // ฟีเจอร์ที่ใช้
  action          String      // การกระทำ
  sessionId       String?     // session ID
  
  // เวลา
  startTime       DateTime    @default(now())
  endTime         DateTime?
  duration        Int?        // ระยะเวลา (มิลลิวินาที)
  
  // ข้อมูลเทคนิค
  ipAddress       String?
  userAgent       String?
  platform        String?     // "web", "mobile", "desktop"
  
  // เมตริก
  clicks          Int         @default(0)
  pageViews       Int         @default(0)
  dataTransferred Int         @default(0) // bytes
  
  @@index([hospitalId])
  @@index([userId])
  @@index([feature])
  @@index([startTime])
  @@map("system_usage")
}